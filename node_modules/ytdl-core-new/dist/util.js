"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const url = __importStar(require("url"));
const formats_1 = __importDefault(require("./formats"));
// const url      = require('url');
// const FORMATS  = require('./formats');
// Use these to help sort formats, higher is better.
const audioEncodingRanks = [
    'mp4a',
    'mp3',
    'vorbis',
    'aac',
    'opus',
    'flac',
];
const videoEncodingRanks = [
    'mp4v',
    'avc1',
    'Sorenson H.283',
    'MPEG-4 Visual',
    'VP8',
    'VP9',
    'H.264',
];
const getBitrate = (format) => parseInt(format.bitrate) || 0;
const audioScore = (format) => {
    const abitrate = format.audioBitrate || 0;
    const aenc = audioEncodingRanks.findIndex(enc => format.codecs && format.codecs.includes(enc));
    return abitrate + aenc / 10;
};
/**
 * Sort formats from highest quality to lowest.
 * By resolution, then video bitrate, then audio bitrate.
 *
 * @param {Object} a
 * @param {Object} b
 */
exports.sortFormats = (a, b) => {
    const ares = a.qualityLabel ? parseInt(a.qualityLabel.slice(0, -1)) : 0;
    const bres = b.qualityLabel ? parseInt(b.qualityLabel.slice(0, -1)) : 0;
    const afeats = ~~!!ares * 2 + ~~!!a.audioBitrate;
    const bfeats = ~~!!bres * 2 + ~~!!b.audioBitrate;
    if (afeats === bfeats) {
        if (ares === bres) {
            let avbitrate = getBitrate(a);
            let bvbitrate = getBitrate(b);
            if (avbitrate === bvbitrate) {
                let aascore = audioScore(a);
                let bascore = audioScore(b);
                if (aascore === bascore) {
                    const avenc = videoEncodingRanks.findIndex(enc => a.codecs && a.codecs.includes(enc));
                    const bvenc = videoEncodingRanks.findIndex(enc => b.codecs && b.codecs.includes(enc));
                    return bvenc - avenc;
                }
                else {
                    return bascore - aascore;
                }
            }
            else {
                return bvbitrate - avbitrate;
            }
        }
        else {
            return bres - ares;
        }
    }
    else {
        return bfeats - afeats;
    }
};
/**
 * Choose a format depending on the given options.
 *
 * @param {Array.<Object>} formats
 * @param {Object} options
 * @return {Object|Error}
 */
exports.chooseFormat = (formats, options) => {
    if (typeof options.format === 'object') {
        return options.format;
    }
    if (options.filter) {
        formats = exports.filterFormats(formats, options.filter);
        if (formats.length === 0) {
            return Error('No formats found with custom filter');
        }
    }
    let format;
    const quality = options.quality || 'highest';
    switch (quality) {
        case 'highest':
            format = formats[0];
            break;
        case 'lowest':
            format = formats[formats.length - 1];
            break;
        case 'highestaudio':
            formats = exports.filterFormats(formats, 'audio');
            format = null;
            for (let f of formats) {
                if (!format
                    || audioScore(f) > audioScore(format))
                    format = f;
            }
            break;
        case 'lowestaudio':
            formats = exports.filterFormats(formats, 'audio');
            format = null;
            for (let f of formats) {
                if (!format
                    || audioScore(f) < audioScore(format))
                    format = f;
            }
            break;
        case 'highestvideo':
            formats = exports.filterFormats(formats, 'video');
            format = null;
            for (let f of formats) {
                if (!format
                    || getBitrate(f) > getBitrate(format))
                    format = f;
            }
            break;
        case 'lowestvideo':
            formats = exports.filterFormats(formats, 'video');
            format = null;
            for (let f of formats) {
                if (!format
                    || getBitrate(f) < getBitrate(format))
                    format = f;
            }
            break;
        default: {
            let getFormat = (itag) => {
                return formats.find((format) => '' + format.itag === '' + itag);
            };
            if (Array.isArray(quality)) {
                quality.find((q) => format = getFormat(q));
            }
            else {
                format = getFormat(quality);
            }
        }
    }
    if (!format) {
        return Error('No such format found: ' + quality);
    }
    return format;
};
/**
 * @param {Array.<Object>} formats
 * @param {Function} filter
 * @return {Array.<Object>}
 */
exports.filterFormats = (formats, filter) => {
    let fn;
    const hasVideo = format => !!format.qualityLabel;
    const hasAudio = format => !!format.audioBitrate;
    switch (filter) {
        case 'audioandvideo':
            fn = (format) => hasVideo(format) && hasAudio(format);
            break;
        case 'video':
            fn = hasVideo;
            break;
        case 'videoonly':
            fn = (format) => hasVideo(format) && !hasAudio(format);
            break;
        case 'audio':
            fn = hasAudio;
            break;
        case 'audioonly':
            fn = (format) => !hasVideo(format) && hasAudio(format);
            break;
        default:
            if (typeof filter === 'function') {
                fn = filter;
            }
            else {
                throw TypeError(`Given filter (${filter}) is not supported`);
            }
    }
    return formats.filter(fn);
};
/**
 * String#indexOf() that supports regex too.
 */
const indexOf = (haystack, needle) => {
    return needle instanceof RegExp ?
        haystack.search(needle) : haystack.indexOf(needle);
};
/**
 * Extract string inbetween another.
 */
exports.between = (haystack, left, right) => {
    let pos = indexOf(haystack, left);
    if (pos === -1) {
        return '';
    }
    haystack = haystack.slice(pos + left.length);
    pos = indexOf(haystack, right);
    if (pos === -1) {
        return '';
    }
    haystack = haystack.slice(0, pos);
    return haystack;
};
/**
 * Get video ID.
 *
 * There are a few type of video URL formats.
 *  - https://www.youtube.com/watch?v=VIDEO_ID
 *  - https://m.youtube.com/watch?v=VIDEO_ID
 *  - https://youtu.be/VIDEO_ID
 *  - https://www.youtube.com/v/VIDEO_ID
 *  - https://www.youtube.com/embed/VIDEO_ID
 *  - https://music.youtube.com/watch?v=VIDEO_ID
 *  - https://gaming.youtube.com/watch?v=VIDEO_ID
 *
 * @param {string} link
 * @return {string|Error}
 */
const validQueryDomains = new Set([
    'youtube.com',
    'www.youtube.com',
    'm.youtube.com',
    'music.youtube.com',
    'gaming.youtube.com',
]);
const validPathDomains = /^https?:\/\/(youtu\.be\/|(www\.)?youtube.com\/)/;
exports.getURLVideoID = (link) => {
    const parsed = url.parse(link, true);
    // /watch/possibleId
    if (parsed.pathname.startsWith('/watch/')) {
        const possibleId = parsed.pathname.split('/')[2];
        if (exports.validateID(possibleId)) {
            return possibleId;
        }
    }
    let id = parsed.query.v;
    if (validPathDomains.test(link) && !id) {
        const paths = parsed.pathname.split('/');
        id = paths[paths.length - 1];
    }
    else if (parsed.hostname && !validQueryDomains.has(parsed.hostname)) {
        return Error('Not a YouTube domain');
    }
    if (!id) {
        return Error('No video id found: ' + link);
    }
    id = id.substring(0, 11);
    if (!exports.validateID(id)) {
        return TypeError(`Video id (${id}) does not match expected ` +
            `format (${idRegex.toString()})`);
    }
    return id;
};
/**
 * Gets video ID either from a url or by checking if the given string
 * matches the video ID format.
 *
 * @param {string} str
 * @return {string|Error}
 */
exports.getVideoID = (str) => {
    if (exports.validateID(str)) {
        return str;
    }
    else {
        return exports.getURLVideoID(str);
    }
};
/**
 * Returns true if given id satifies YouTube's id format.
 *
 * @param {string} id
 * @return {boolean}
 */
const idRegex = /^[a-zA-Z0-9-_]{11}$/;
exports.validateID = (id) => {
    return idRegex.test(id);
};
/**
 * Checks wether the input string includes a valid id.
 *
 * @param {string} string
 * @return {boolean}
 */
exports.validateURL = (string) => {
    return !(exports.getURLVideoID(string) instanceof Error);
};
/**
 * @param {Object} format
 * @return {Object}
 */
exports.addFormatMeta = (format) => {
    format = Object.assign({}, formats_1.default[format.itag], format);
    format.container = format.mimeType ?
        format.mimeType.split(';')[0].split('/')[1] : null;
    format.codecs = format.mimeType ?
        exports.between(format.mimeType, 'codecs="', '"') : null;
    format.live = /\/source\/yt_live_broadcast\//.test(format.url);
    format.isHLS = /\/manifest\/hls_(variant|playlist)\//.test(format.url);
    format.isDashMPD = /\/manifest\/dash\//.test(format.url);
    return format;
};
/**
 * Get only the string from an HTML string.
 *
 * @param {string} html
 * @return {string}
 */
exports.stripHTML = (html) => {
    return html
        .replace(/[\n\r]/g, ' ')
        .replace(/\s*<\s*br\s*\/?\s*>\s*/gi, '\n')
        .replace(/<\s*\/\s*p\s*>\s*<\s*p[^>]*>/gi, '\n')
        .replace(/<.*?>/gi, '')
        .trim();
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL2xpYi91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLHlDQUEyQjtBQUMzQix3REFBZ0M7QUFFaEMsbUNBQW1DO0FBQ25DLHlDQUF5QztBQUd6QyxvREFBb0Q7QUFDcEQsTUFBTSxrQkFBa0IsR0FBRztJQUN6QixNQUFNO0lBQ04sS0FBSztJQUNMLFFBQVE7SUFDUixLQUFLO0lBQ0wsTUFBTTtJQUNOLE1BQU07Q0FDRSxDQUFDO0FBQ1gsTUFBTSxrQkFBa0IsR0FBRztJQUN6QixNQUFNO0lBQ04sTUFBTTtJQUNOLGdCQUFnQjtJQUNoQixlQUFlO0lBQ2YsS0FBSztJQUNMLEtBQUs7SUFDTCxPQUFPO0NBQ0MsQ0FBQztBQUVYLE1BQU0sVUFBVSxHQUFHLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM3RCxNQUFNLFVBQVUsR0FBRyxDQUFDLE1BQU0sRUFBRSxFQUFFO0lBQzVCLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxZQUFZLElBQUksQ0FBQyxDQUFDO0lBQzFDLE1BQU0sSUFBSSxHQUFHLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMvRixPQUFPLFFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQzlCLENBQUMsQ0FBQztBQUdGOzs7Ozs7R0FNRztBQUNVLFFBQUEsV0FBVyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO0lBQ2xDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FB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